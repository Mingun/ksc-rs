Список контекстов:
- `meta.endian.switch-on`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Должно быть запрещено, если выражение зависит от поля, которое требует этого выражения|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |+|`_`                |Запрещено|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get**|
  |+|`_buf`             |Запрещено|Компилятор не знает такой переменной в данном контексте, выдает **undefined io.kaitai.struct.format.InvalidIdentifier: invalid ID: '\_buf', expected /^[a-z][a-z0-9_]*$/**|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). Должно быть запрещено -- не имеет смысла в данном контексте|
  |+|`_io`              |Разрешено| |
  |+|`_is_le`           |Запрещено|Компилятор не знает такой переменной в данном контексте, выдает **undefined io.kaitai.struct.format.InvalidIdentifier: invalid ID: '\_is_le', expected /^[a-z][a-z0-9_]*$/**|
  |~|`_on`              |Неизвестно|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get**|
  |?|`_parent`          |Разрешено|На выражении `_parent._sizeof` выдает ошибку **undefined scala.MatchError: CalcKaitaiStructType (of class io.kaitai.struct.datatype.DataType$CalcKaitaiStructType$)**|
  |+|`_root`            |Разрешено|Ссылка на корневой тип в спецификации|
  |+|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- `meta.endian.cases.<case>`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Должно быть запрещено, если выражение зависит от поля, которое требует этого выражения|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Несуществующее поле|Разрешено|Должна быть ошибка компиляции|
  |+|`_`                |Разрешено|Специальное значение -- `default` метка|
  |-|`_buf`             |Разрешено|Генерируется доступ к несуществующему полю (`_buf` в JS). Эта общая ошибка #930|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной индекса цикла, ошибка на этапе выполнения. Должна быть ошибка при компиляции|
  |+|`_io`              |Разрешено|Соответствие типа `switch-on` выражению не проверяется|
  |-|`_is_le`           |Разрешено|Генерируется доступ к несуществующему полю (`_isLe` в JS). Эта общая ошибка #930|
  |-|`_on`              |Разрешено|Генерируется доступ к несуществующей переменной (`on` в JS)|
  |?|`_parent`          |Разрешено|Вероятно, из-за #930 проверок типа не делается|
  |+|`_root`            |Разрешено|Аналогично `_parent`|
  |+|`_sizeof`          |Разрешено для структур константного размера|Подставляется размер корневой структуры|

- `<type>.seq[i].if` или `instances.<instance>.if`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |-|`_`                |Разрешено|Компилятор генерирует доступ к несуществующей локальной переменной (`_` в JS)|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). Должно быть запрещено -- `if` проверяется до цикла, так что даже в `repeat` атрибуте переменная не имеет смысла|
  |+|`_io`              |Разрешено|Аналогично `size`|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |~|`_root`            |Разрешено|Ссылка на корневой тип в спецификации. Если используется в корневом типе в `seq`, то размер типа будет плавающим, но константа, тем не менее, генерируется одна (#927)|
  |~|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции. Замечания аналогичны `_root` (#927)|

- `<type>.seq[i].process` или `instances.<instance>.process`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Должно быть запрещено, если выражение зависит от поля, которое требует этого выражения|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Несуществующее поле|Разрешено|Должна быть ошибка компиляции|
  |-|`_`                |Разрешено|Генерируется доступ к несуществующей переменной (`_` в JS)|
  |-|`_buf`             |Разрешено|Генерируется доступ к несуществующему полю (`_buf` в JS). Эта общая ошибка #930|
  |~|`_index`           |Разрешено|Аналогично `size`|
  |+|`_io`              |Разрешено| |
  |-|`_is_le`           |Разрешено|Генерируется доступ к несуществующему полю (`_isLe` в JS). Эта общая ошибка #930|
  |-|`_on`              |Разрешено|Генерируется доступ к несуществующей переменной (`on` в JS)|
  |+|`_parent`          |Разрешено| |
  |+|`_root`            |Разрешено| |
  |+|`_sizeof`          |Разрешено для структур константного размера|Подставляется размер корневой структуры|

- `<type>.seq[i].repeat-expr` или `instances.<instance>.repeat-expr`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено|Аналогично `size`|
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |?|`_`                |Неизвестно|Технически разрешено, но пока не удалось найти выражение, которое пропустит компилятор. Однако ошибки от компилятора явно внутренние, так что возможно, что такое выражение существует. В частности, `_.size` выдает **undefined java.util.NoSuchElementException: None.get**|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS) при создании массива и всегда `i < i` в условии цикла. Должно быть запрещено|
  |+|`_io`              |Разрешено|Аналогично `size`|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |?|`_root`            |Разрешено|Аналогично `size`|
  |+|`_sizeof`          |Разрешено для структур константного размера|Аналогично `size`|

- `<type>.seq[i].repeat-until` или `instances.<instance>.repeat-until`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено|Аналогично `if`|
  |+|`seq` атрибут      |Разрешено|Аналогично `if`|
  |+|`instances` атрибут|Разрешено|Аналогично `if`|
  |-|Ссылка на себя     |Разрешено|Аналогично `if`|
  |+|Несуществующее поле|Запрещено|Аналогично `if`|
  |~|`_`                |Разрешено|Ссылка на последний разобранный элемент, однако эта ссылка может быть вне пределов видимости (по крайней мере в JS). Должно быть разрешено|
  |-|`_buf`             |Запрещено|Ссылка на неразобранное значение текущего атрибута. Суда по документации, должно быть доступно, но возможно, не во всех случаях|
  |+|`_index`           |Разрешено|Индекс текущей итерации цикла|
  |+|`_io`              |Разрешено|Аналогично `if`|
  |+|`_is_le`           |Запрещено|Аналогично `if`|
  |~|`_on`              |Неизвестно|Аналогично `if`|
  |?|`_parent`          |Неизвестно|Аналогично `if`|
  |~|`_root`            |Разрешено|Аналогично `if`|
  |~|`_sizeof`          |Разрешено для структур константного размера|Аналогично `if`|

- `<type>.seq[i].size` или `instances.<instance>.size`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Компилятор не проверяет, что атрибут должен находится до текущего `seq` элемента|
  |~|`instances` атрибут|Разрешено|Компилятор не проверяет зависимости -- можно ссылаться на атрибуты, которые будут разобраны позже или организовать циклическую зависимость (#926)|
  |-|Ссылка на себя     |Разрешено|Компилятор должен детектировать прямые и косвенные циклы и запрещать их|
  |+|Несуществующее поле|Запрещено|Релизная версия сообщает об ошибке, в мастере генерируется доступ к несуществующему полю|
  |?|`_`                |Неизвестно|Технически разрешено, но компилятор выдает малопонятные ошибки, явно возникшие случайным образом из-за каких-то нарушений, а не из-за явного запрета переменной, так что возможно есть случай, когда разрешено|
  |+|`_buf`             |Запрещено|Компилятор не знает такой переменной в данном контексте, выдает **undefined io.kaitai.struct.precompile.ErrorInInput: contexts: /seq/1/size: invalid ID: '\_buf', expected /^[a-z][a-z0-9_]*$/**|
  |~|`_index`           |Разрешено|Генерируется доступ к переменной цикла. Должно быть запрещено, если атрибут не `repeat`|
  |+|`_io`              |Разрешено|Текущий поток чтения|
  |+|`_is_le`           |Запрещено|Компилятор не знает такой переменной в данном контексте, выдает **undefined io.kaitai.struct.precompile.ErrorInInput: contexts: /seq/1/size: invalid ID: '\_is_le', expected /^[a-z][a-z0-9_]*$/**|
  |~|`_on`              |Неизвестно|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get**. Нет уверенности, что в каких-то случаях оно не станет разрешенным|
  |?|`_parent`          |Неизвестно|Компилятор выдает **undefined java.lang.RuntimeException: Unable to derive _parent type in <имя-типа>**. Нет уверенности, что в каких-то случаях оно не станет разрешенным|
  |~|`_root`            |Разрешено|Ссылка на корневой тип в спецификации. При использовании в корневом типе в `seq` в виде `_root._sizeof` компилятор невнятно ругается, хотя очевидно, что возникает циклическая зависимость -- попытка вычислить размер поля исходя из размера типа, в котором находится данное поле. Такое должно быть запрещено (#927)|
  |~|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции. Замечания аналогичны `_root` (#927)|

- `<type>.seq[i].type` или `instances.<instance>.type`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |?|`_`                |Разрешено|Компилятор генерирует доступ к несуществующей локальной переменной (`_` в JS) или переменной текущей итерации в при наличии `repeat-until`, которая позволяет получить доступ к предыдущей итерации. В JS эта переменная ошибочно объявляется в том же блоке (но с `var`, поэтому в общем ошибки нет), поэтому возможно это ожидаемое поведение|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |~|`_index`           |Разрешено|Индекс текущей итерации цикла. Должно быть разрешено только при наличии `repeat`, иначе запрещено. В настоящий момент всегда разрешено и генерируется доступ к не объявленной переменной цикла (`i` в JS)|
  |+|`_io`              |Разрешено|Аналогично `size`|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |~|`_root`            |Разрешено|Ссылка на корневой тип в спецификации. Почему-то во время исполнения возникает ошибка **undefined InternalError: too much recursion**, даже когда переданный параметром тип не используется|
  |+|`_sizeof`          |Разрешено для структур константного размера| |


- `<type>.seq[i].type.switch-on` или `instances.<instance>.type.switch-on`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |~|`_`                |Неизвестно|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get**|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). Должно быть запрещено|
  |+|`_io`              |Разрешено|Аналогично `size`|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |~|`_root`            |Разрешено|Ссылка на корневой тип в спецификации|
  |~|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- `<type>.seq[i].type.cases.<case>` или `instances.<instance>.type.cases.<case>`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |+|`_`                |Разрешено|Специальное значение -- `default` метка|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). Должно быть запрещено|
  |+|`_io`              |Разрешено|Аналогично `size`|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Запрещено|Компилятор выдает **undefined io.kaitai.struct.precompile.ErrorInInput: builtin: /seq/1/type/cases/Name(identifier(_on)): None.get**|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |~|`_root`            |Разрешено|Ссылка на корневой тип в спецификации|
  |~|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- `instances.<instance>.io`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |~|`_`                |Неизвестно|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get**|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). Должно быть запрещено -- поток инициализируется до начала цикла и на него эта переменная не влияет|
  |+|`_io`              |Разрешено|Доступ к текущему потоку|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |+|`_root`            |Разрешено|Ссылка на корневой тип в спецификации|
  |+|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- `instances.<instance>.pos`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |~|`_`                |Неизвестно|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get** на выражение `_.size`|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). Должно быть запрещено -- позиция устанавливается до начала цикла|
  |+|`_io`              |Разрешено|Доступ к текущему потоку|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |+|`_root`            |Разрешено|Ссылка на корневой тип в спецификации|
  |+|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- `instances.<instance>.value`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |~|Ссылка на себя     |Запрещено|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get**|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |~|`_`                |Неизвестно|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get** на выражение `_.size`|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). Должно быть запрещено|
  |+|`_io`              |Разрешено|Доступ к текущему потоку|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Неизвестно|Аналогично `size`|
  |+|`_root`            |Разрешено|Ссылка на корневой тип в спецификации|
  |+|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- `<type>.seq[i].valid` или `instances.<instance>.valid`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |-|Ссылка на себя     |Разрешено|Аналогично `size`|
  |+|Несуществующее поле|Запрещено|Аналогично `size`|
  |~|`_`                |Неизвестно|Компилятор выдает невнятную ошибку **undefined java.util.NoSuchElementException: None.get**|
  |+|`_buf`             |Запрещено|Аналогично `size`|
  |~|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной цикла (`i` в JS). При наличии цикла не удалось составить выражение таким образом, чтобы оно скомпилировалось|
  |+|`_io`              |Разрешено|Доступ к текущему потоку|
  |+|`_is_le`           |Запрещено|Аналогично `size`|
  |~|`_on`              |Неизвестно|Аналогично `size`|
  |?|`_parent`          |Разрешено|Не удалось составить выражение таким образом, чтобы оно скомпилировалось -- компилятор постоянно выдает внутренние ошибки|
  |+|`_root`            |Разрешено|Ссылка на корневой тип в спецификации|
  |+|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- `<type>.seq[i].parent` или `instances.<instance>.parent` -- не является истинным выражением, доступна только цепочка вызовов
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|

- `args` пользовательского типа
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|

- `<type>.to-string` -- undocumented
  Возвращаемое значение может не быть строкой; в языках со строгой системой типов будет ошибка компиляции
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|
  |+|Параметр `<type>`  |Разрешено| |
  |~|`seq` атрибут      |Разрешено|Аналогично `size`|
  |~|`instances` атрибут|Разрешено|Аналогично `size`|
  |+|Ссылка на себя     |-|Нет способа создать|
  |-|Несуществующее поле|Разрешено|Генерируется доступ к неизвестному полю|
  |-|`_`                |Разрешено|Генерируется доступ к не объявленной переменной (`_` в JS)|
  |-|`_buf`             |Разрешено|Генерируется доступ к неизвестному полю (`this._buf` в JS)|
  |-|`_index`           |Разрешено|Генерируется доступ к не объявленной переменной (`i` в JS)|
  |+|`_io`              |Разрешено|Доступ к текущему потоку (`this._io` в JS)|
  |-|`_is_le`           |Разрешено|Генерируется доступ к неизвестному полю (`this._isLe` в JS)|
  |-|`_on`              |Разрешено|Генерируется доступ к не объявленной переменной (`on` в JS)|
  |+|`_parent`          |Разрешено|Ссылка на родительский тип (`this._parent` в JS)|
  |+|`_root`            |Разрешено|Ссылка на корневой тип в спецификации (`this._root` в JS)|
  |+|`_sizeof`          |Разрешено для структур константного размера|Раскрывается в константу времени компиляции|

- аргументы классов типажа `ValidationSpec`
  |OK?|Переменная|Текущий статус|Комментарий|
  |---|----------|--------------|-----------|

getOptValueExpression
Expressions.parse

|Variable|Context|Meaning|
|--------|-------|-------|
|`_root` |`instances.<...>.io`|Reference to a root type in the current file|
|...|...|...|


    _
    _buf
    _index
    _io
    _is_le
    _on
    _parent
    _root
    _sizeof   - только у корневого типа https://github.com/kaitai-io/kaitai_struct_compiler/blob/0acfa60452a10b770a2c2e746f3de057f8ab76d9/shared/src/main/scala/io/kaitai/struct/translators/BaseTranslator.scala#L65-L70

  Сообщить об ошибках в текущем мастере:
    _buf
    _is_le